<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="https://cscot.pages.dev/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16-next.png">
  <link rel="mask-icon" href="https://cscot.pages.dev/images/logo.svg" color="#222">

<link rel="stylesheet" href="css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"cscot.pages.dev","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="cscot">
<meta property="og:url" content="https://cscot.pages.dev/index.html">
<meta property="og:site_name" content="cscot">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Computer Scot">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cscot.pages.dev/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>cscot</title>
  








  <noscript>
    <link rel="stylesheet" href="css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="https://cscot.pages.dev/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">cscot</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Computer Scot</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="https://cscot.pages.dev/archives/">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/15/openvpn-through-hysteria2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/15/openvpn-through-hysteria2/" class="post-title-link" itemprop="url">OpenVPN through Hysteria2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-15 01:01:01" itemprop="dateCreated datePublished" datetime="2023-09-15T01:01:01+00:00">2023-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Linux-server"><a href="robots.txt.html#Linux-server" class="headerlink" title="Linux server"></a>Linux server</h2><p>You will need a server, a domain name, and a hostname DNS <code>A</code> record (or <code>AAAA</code> or IPv6). Our example domain name will be <code>example.com</code>, and our example hostname will be <code>vps5.example.com</code>.</p>
<p>Open ports <code>tcp/80</code>, <code>tcp/443</code>, and <code>udp/443</code> in the server firewall. <strong>Note that Hysteria uses UDP</strong>.</p>
<p>Update server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt upgrade -y</span><br></pre></td></tr></table></figure>

<p>Download the OpenVPN install script from <a target="_blank" rel="noopener" href="https://github.com/angristan/openvpn-install">https://github.com/angristan/openvpn-install</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh</span><br><span class="line">chmod +x openvpn-install.sh</span><br></pre></td></tr></table></figure>

<p>Then run it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./openvpn-install.sh</span><br></pre></td></tr></table></figure>

<p>When prompted, specify your server public IP address. You can use the default port of <code>udp/1194</code>. This need not be open in your server firewall, since traffic arrives via Hysteria.</p>
<p>Give your first client a name, e.g. <code>windows</code>. The client configuration file is written to <code>/root/windows.ovpn</code> (in this example).</p>
<p>The OpenVPN install script opens port <code>udp/1194</code> in <code>iptables</code>. If you want to further conceal your server, close this port by manually editing <code>/etc/iptables/add-openvpn-rules.sh</code> and <code>/etc/iptables/rm-openvpn-rules.sh</code>. Remove the lines for <code>udp/1194</code> in both files. Then reboot.</p>
<p>Install Hysteria on the server using the script provided by the Hysteria developers:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL https://get.hy2.sh)</span><br></pre></td></tr></table></figure>

<p>Edit the server configuration file at <code>/etc/hysteria/config.yaml</code> using an editor such as <code>vi</code> or <code>nano</code>. Specify your server hostname, your email, and your choice of password (or use the default generated by the install script). Optionally you can also change the masquerade URL. See the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">Hysteria2 documentation</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># listen: :443</span><br><span class="line"></span><br><span class="line">acme:</span><br><span class="line">  domains:</span><br><span class="line">    - vps5.example.com</span><br><span class="line">  email: cscot@example.com</span><br><span class="line"></span><br><span class="line">auth:</span><br><span class="line">  type: password</span><br><span class="line">  password: me4asbXgfACRHnJv7z6SPrhW</span><br><span class="line"></span><br><span class="line">masquerade:</span><br><span class="line">  type: proxy</span><br><span class="line">  proxy:</span><br><span class="line">    url: https://news.ycombinator.com/</span><br><span class="line">    rewriteHost: true</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<p>Optionally set the log level by editing the file <code>/etc/systemd/system/hysteria-server.service</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Environment=HYSTERIA_LOG_LEVEL=debug</span><br></pre></td></tr></table></figure>

<p>If you make this change, then after saving the file also do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>Start your Hysteria server with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start hysteria-server</span><br></pre></td></tr></table></figure>

<p>Configure Hysteria to start on system boot with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable hysteria-server</span><br></pre></td></tr></table></figure>

<p>You can view the server log at any time with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u hysteria-server</span><br></pre></td></tr></table></figure>

<h2 id="Windows-client"><a href="robots.txt.html#Windows-client" class="headerlink" title="Windows client"></a>Windows client</h2><p>Download the latest Hysteria for Windows from <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/releases">https://github.com/apernet/hysteria/releases</a>. The file you need for most Windows PCs will be <code>hysteria-windows-amd64.exe</code>.</p>
<p>Create a configuration file <code>config.yaml</code> in the same directory as <code>hysteria-windows-amd64.exe</code>, which by default will be <code>Downloads</code>.</p>
<p>Make the client <code>config.yaml</code> match your server address and password, and your bandwidth capabilities. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server: vps5.example.com:443 </span><br><span class="line"></span><br><span class="line">auth: me4asbXgfACRHnJv7z6SPrhW</span><br><span class="line"></span><br><span class="line">bandwidth: </span><br><span class="line">  up: 10 mbps</span><br><span class="line">  down: 20 mbps</span><br><span class="line"></span><br><span class="line">socks5:</span><br><span class="line">  listen: 127.0.0.1:10808</span><br><span class="line"></span><br><span class="line">http:</span><br><span class="line">  listen: 127.0.0.1:10809</span><br><span class="line"></span><br><span class="line">udpForwarding:</span><br><span class="line">  - listen: 127.0.0.1:1194</span><br><span class="line">    remote: 127.0.0.1:1194 </span><br><span class="line">    timeout: 20s </span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/advanced/Full-Client-Config">documentation</a> for details of the client configuration file.</p>
<p>Open a Command Prompt window and change into your <code>Downloads</code> directory. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads</span><br></pre></td></tr></table></figure>

<p>Optionally set the log level:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set HYSTERIA_LOG_LEVEL=debug</span><br></pre></td></tr></table></figure>

<p>Start the program with the configuration file <code>config.yaml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\hysteria-windows-amd64.exe</span><br></pre></td></tr></table></figure>

<p>Leave the Command Prompt window open with Hysteria running in it.</p>
<p>You can view the client log at any time by looking at the Command Prompt window.</p>
<p>Open a PowerShell window. Securely download the generated client configuration file from the server, e.g.:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp root@vps5.example.com:/root/windows.ovpn Downloads</span><br></pre></td></tr></table></figure>

<p>Edit the file <code>Downloads/windows.ovpn</code> in an editor such as Notepad or <a target="_blank" rel="noopener" href="https://notepad-plus-plus.org/">Notepad++</a>.</p>
<p>Make it look as if the remote server is on localhost by changing the <code>remote</code> line to read:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remote 127.0.0.1 1194</span><br></pre></td></tr></table></figure>

<p>Also insert these two lines, replacing <code>YOUR.SERVER.IP.ADDRESS</code> by your actual server IP address:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">route YOUR.SERVER.IP.ADDRESS 255.255.255.255 net_gateway</span><br><span class="line">block-outside-dns</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<p>If you have not already done so, install the OpenVPN GUI client for Windows from <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads">https://openvpn.net/community-downloads</a>.</p>
<p>Import the amended client configuration file <code>Downloads/windows.ovpn</code> into the OpenVPN GUI.</p>
<p>Connect the OpenVPN client to the OpenVPN server.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/14/hysteria2-install-script/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/14/hysteria2-install-script/" class="post-title-link" itemprop="url">Hysteria2 install script</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-14 01:01:01" itemprop="dateCreated datePublished" datetime="2023-09-14T01:01:01+00:00">2023-09-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Now that Hysteria2 is officially released, there is a Hysteria2 install script. This post demonstrates the install process using the official script.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria">Hysteria2</a> uses a custom version of the QUIC (Quick UDP Internet Connections) protocol to deliver unparalleled performance over unreliable or lossy networks. The protocol is designed to masquerade as standard HTTP&#x2F;3 traffic, making it difficult to detect and block without widespread collateral damage. Hysteria2 is almost a complete rewrite of the original Hysteria, with a new protocol and new features. Version 2 documentation is at <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">https://v2.hysteria.network</a>. Hysteria2 is not compatible with the original Hysteria, so users must choose either version 1 or version 2 for both client and server.</p>
<p><a target="_blank" rel="noopener" href="https://v2.hysteria.network/zh/docs/misc/Hysteria-Brutal">Hysteria 是暴力多倍发包吗？</a></p>
<h2 id="Linux-server"><a href="robots.txt.html#Linux-server" class="headerlink" title="Linux server"></a>Linux server</h2><p>You will need a server, a domain name, and a hostname DNS <code>A</code> record (or <code>AAAA</code> or IPv6).</p>
<p>Open ports <code>tcp/80</code>, <code>tcp/443</code>, and <code>udp/443</code> in the server firewall. <strong>Note that Hysteria uses UDP</strong>.</p>
<p>Install Hysteria on the server using script provided by the Hysteria developers:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -fsSL https://get.hy2.sh)</span><br></pre></td></tr></table></figure>

<p>Edit the server configuration file at <code>/etc/hysteria/config.yaml</code> using an editor such as <code>vi</code> or <code>nano</code>. Specify your server hostname, your email, and your choice of password (or use the default generated by the install script). Optionally you can also change the masquerade URL. See the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">Hysteria2 documentation</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># listen: :443</span><br><span class="line"></span><br><span class="line">acme:</span><br><span class="line">  domains:</span><br><span class="line">    - vps4.example.com</span><br><span class="line">  email: cscot@example.com</span><br><span class="line"></span><br><span class="line">auth:</span><br><span class="line">  type: password</span><br><span class="line">  password: DwrfLQxpFprtwqUbkZOEDKiw</span><br><span class="line"></span><br><span class="line">masquerade:</span><br><span class="line">  type: proxy</span><br><span class="line">  proxy:</span><br><span class="line">    url: https://news.ycombinator.com/</span><br><span class="line">    rewriteHost: true</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<p>Start your Hysteria server with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start hysteria-server</span><br></pre></td></tr></table></figure>

<p>Configure Hysteria to start on system boot with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable hysteria-server</span><br></pre></td></tr></table></figure>

<h2 id="Windows-client"><a href="robots.txt.html#Windows-client" class="headerlink" title="Windows client"></a>Windows client</h2><p>Download the latest Hysteria for Windows from <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/releases">https://github.com/apernet/hysteria/releases</a>. The file you need for most Windows PCs will be <code>hysteria-windows-amd64.exe</code>.</p>
<p>Create a configuration file <code>config.yaml</code> in the same directory as <code>hysteria-windows-amd64.exe</code>, which by default will be <code>Downloads</code>.</p>
<p>Make the client <code>config.yaml</code> match your server address and password, and your bandwidth capabilities. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server: vps4.example.com:443 </span><br><span class="line"></span><br><span class="line">auth: DwrfLQxpFprtwqUbkZOEDKiw</span><br><span class="line"></span><br><span class="line">bandwidth: </span><br><span class="line">  up: 10 mbps</span><br><span class="line">  down: 20 mbps</span><br><span class="line"></span><br><span class="line">socks5:</span><br><span class="line">  listen: 127.0.0.1:10808</span><br><span class="line"></span><br><span class="line">http:</span><br><span class="line">  listen: 127.0.0.1:10809</span><br></pre></td></tr></table></figure>

<p>See the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/advanced/Full-Client-Config">documentation</a> for details of the client configuration file.</p>
<p>Open a Command Prompt window and change into your <code>Downloads</code> directory. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads</span><br></pre></td></tr></table></figure>

<p>Optionally set the log level:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set HYSTERIA_LOG_LEVEL=debug</span><br></pre></td></tr></table></figure>

<p>Start the program with the configuration file <code>config.yaml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\hysteria-windows-amd64.exe</span><br></pre></td></tr></table></figure>

<p>Leave the Command Prompt window open with Hysteria running in it.</p>
<p>Now either proxy an individual browser to <code>127.0.0.1</code> port <code>10808</code> or set the Windows system proxy (<strong>Settings</strong> &gt; <strong>Network &amp; Internet</strong> &gt; <strong>Proxy</strong> &gt; <strong>Manual proxy setup</strong>).</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/13/hysteria2-furious/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/13/hysteria2-furious/" class="post-title-link" itemprop="url">Hysteria2 with Furious</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-13 01:01:01" itemprop="dateCreated datePublished" datetime="2023-09-13T01:01:01+00:00">2023-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://cscot.pages.dev/images/hysteria2-furious.png" alt="Furious edit server screen"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria">Hysteria2</a> uses a custom version of the QUIC (Quick UDP Internet Connections) protocol to deliver unparalleled performance over unreliable or lossy networks. The protocol is designed to masquerade as standard HTTP&#x2F;3 traffic, making it difficult to detect and block without widespread collateral damage. Hysteria2 is almost a complete rewrite of the original Hysteria, with a new protocol and new features. Version 2 documentation is at <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">https://v2.hysteria.network</a>. Hysteria2 is not compatible with the original Hysteria, so users must choose either version 1 or version 2 for both client and server.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/LorenEteval/Furious">Furious</a> is a cross-platform GUI client that supports Xray-core and hysteria. </p>
<p>This post documents a procedure for using Hysteria2 on a Linux server and accessing it from a Furious client on Windows.</p>
<p>If you need support:</p>
<ul>
<li>For Hysteria problems, see the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/advanced/Troubleshooting">Troubleshooting</a> page, and if you still need support, go to the GitHub <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/issues">Issues</a> page.</li>
<li>For Furious, see the <a target="_blank" rel="noopener" href="https://github.com/LorenEteval/Furious/wiki">wiki</a> and the <a target="_blank" rel="noopener" href="https://github.com/LorenEteval/Furious/issues">Issues</a> page.</li>
</ul>
<h2 id="Hysteria2-server"><a href="robots.txt.html#Hysteria2-server" class="headerlink" title="Hysteria2 server"></a>Hysteria2 server</h2><p>The main installation instructions for Hysteria2 are at <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/getting-started/Installation">https://v2.hysteria.network/docs/getting-started/Installation</a>. This demonstration uses material from <a target="_blank" rel="noopener" href="https://github.com/chika0801/hysteria-install">https://github.com/chika0801/hysteria-install</a>. </p>
<p>The server in this scenario has 1 GB of RAM and runs Ubuntu 22.04. It is assumed that you SSH into your server as <code>root</code>.</p>
<p>You will need a domain name and a DNS record pointing from your hostname to your server IP address. Our examples use <code>vps3.example.com</code> as the sample hostname.</p>
<p>When using standalone mode to apply for or renew a certificate, the script will listen on port <code>tcp/80</code>. If port <code>tcp/80</code> is occupied, the script will fail. Therefore nothing else should be listening on port <code>tcp/80</code>.</p>
<p>As well as opening port <code>tcp/80</code> in your firewall, you will also need to open port <code>udp/443</code> for the Hysteria server. <strong>Note that Hysteria uses UDP.</strong></p>
<p>Set up the ACME script ready to request a free SSL certificate and private key from Let’s Encrypt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y socat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias acme.sh=~/.acme.sh/acme.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure>

<p>Request a free Elliptic Curve Cryptography certificate for your hostname in standalone mode. Change <code>vps3.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d vps3.example.com --standalone --keylength ec-256</span><br></pre></td></tr></table></figure>

<p>Install the SSL certificate and key to the <code>/etc/ssl/private</code> directory. Change <code>vps3.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d vps3.example.com --ecc --fullchain-file /etc/ssl/private/fullchain.cer --key-file /etc/ssl/private/private.key</span><br></pre></td></tr></table></figure>

<p>Force certificate renewal. Change <code>vps3.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --renew -d vps3.example.com --force --ecc</span><br></pre></td></tr></table></figure>

<p>Install the Hysteria program on your server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /root/hysteria https://github.com/apernet/hysteria/releases/latest/download/hysteria-linux-amd64 &amp;&amp; chmod +x /root/hysteria &amp;&amp; mv -f /root/hysteria /usr/local/bin</span><br></pre></td></tr></table></figure>

<p>Check the installation of Hysteria2 has worked:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hysteria version</span><br></pre></td></tr></table></figure>

<p>Download the configuration template:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /root/hysteria_config.yaml https://raw.githubusercontent.com/chika0801/hysteria-install/main/config_server.yaml</span><br></pre></td></tr></table></figure>

<p>Edit the configuration file. If you prefer the <code>vi</code> editor:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/hysteria_config.yaml</span><br></pre></td></tr></table></figure>

<p>If you prefer the <code>nano</code> editor:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/hysteria_config.yaml</span><br></pre></td></tr></table></figure>

<p>Change at least the TLS locations and the password. Here is an example. For explanations see the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">Hysteria2 documentation</a>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">listen: :443</span><br><span class="line"></span><br><span class="line">tls:</span><br><span class="line">  cert: /etc/ssl/private/fullchain.cer</span><br><span class="line">  key: /etc/ssl/private/private.key</span><br><span class="line"></span><br><span class="line">auth:</span><br><span class="line">  type: password</span><br><span class="line">  password: Eckhu7AQitevDe8K</span><br><span class="line"></span><br><span class="line">resolver:</span><br><span class="line">  type: https</span><br><span class="line">  https:</span><br><span class="line">    addr: 1.1.1.1:443</span><br><span class="line">    timeout: 10s</span><br><span class="line"></span><br><span class="line">acl:</span><br><span class="line">  inline:</span><br><span class="line">    - reject(geoip:cn)</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<p>Download the systemd service file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /etc/systemd/system/hysteria.service https://raw.githubusercontent.com/chika0801/hysteria-install/main/hysteria.service &amp;&amp; systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>Start the service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable hysteria</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start hysteria</span><br></pre></td></tr></table></figure>

<p>Check that Hysteria is <code>active (running)</code> on the server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status hysteria</span><br></pre></td></tr></table></figure>

<p>If necessary, check the log:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u hysteria</span><br></pre></td></tr></table></figure>

<p>Check that Hysteria is listening on port <code>udp/443</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tulpn</span><br></pre></td></tr></table></figure>

<p>Exit your SSH session with the server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<h2 id="Furious-client"><a href="robots.txt.html#Furious-client" class="headerlink" title="Furious client"></a>Furious client</h2><p>Now go to work on the PC that will be your client.</p>
<p>Prepare a JSON client configuration that matches your server. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;server&quot;: &quot;vps3.example.com:443&quot;,</span><br><span class="line">    &quot;auth&quot;: &quot;Eckhu7AQitevDe8K&quot;,</span><br><span class="line">    &quot;tls&quot;: &#123;</span><br><span class="line">        &quot;sni&quot;: &quot;vps3.example.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;bandwidth&quot;: &#123;</span><br><span class="line">        &quot;up&quot;: &quot;10 mbps&quot;,</span><br><span class="line">        &quot;down&quot;: &quot;20 mbps&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;socks5&quot;: &#123;</span><br><span class="line">        &quot;listen&quot;: &quot;127.0.0.1:10808&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;listen&quot;: &quot;127.0.0.1:10809&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Copy the client JSON configuration to your PC clipboard.</p>
<p>Open a browser, and go to the <a target="_blank" rel="noopener" href="https://github.com/LorenEteval/Furious/releases">Furious releases</a> page on GitHub.</p>
<p>Download the latest version for Windows, e.g. <code>Furious-0.2.6-windows-x86_64.zip</code>. </p>
<p>Extract the archive.</p>
<p>Launch the application <code>Furious.exe</code>.</p>
<p>If Windows Defender SmartScreen appears, click <strong>Run anyway</strong>.</p>
<p>Right-click the Furious icon in the Windows system tray to bring up the context menu.</p>
<p>Select <strong>Import</strong> &gt; <strong>Import JSON Configuration from Clipboard</strong>.</p>
<p>You should see a message, <code>Import JSON confuguration success.</code></p>
<p>Right-click the Furious icon in the Windows system tray again to once more bring up the context menu.</p>
<p>Select <strong>Connect</strong>.</p>
<p>Now you can either proxy an individual browser, or set the Windows system proxy, to use the SOCKS5 proxy server on localhost port <code>10808</code> (in our example).</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/08/wireguard-xray-relay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/08/wireguard-xray-relay/" class="post-title-link" itemprop="url">WireGuard through Xray relay server</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-08 06:00:00" itemprop="dateCreated datePublished" datetime="2023-09-08T06:00:00+00:00">2023-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This architecture is a result of discussion #2530 on GitHub.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+</span><br><span class="line">| Client device     |</span><br><span class="line">|                   |</span><br><span class="line">| WireGuard peer    |</span><br><span class="line">|                   |</span><br><span class="line">+---------+---------+</span><br><span class="line">          |</span><br><span class="line">          |</span><br><span class="line">          V</span><br><span class="line">+-------------------+</span><br><span class="line">| Relay server      |</span><br><span class="line">|                   |</span><br><span class="line">| Xray client       |</span><br><span class="line">|                   |</span><br><span class="line">+---------+---------+</span><br><span class="line">          |</span><br><span class="line">          |</span><br><span class="line">          V</span><br><span class="line">+-------------------+</span><br><span class="line">| Final server      |</span><br><span class="line">|                   |</span><br><span class="line">| Xray server       |</span><br><span class="line">| WireGuard peer    |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure>

<h2 id="Final-server"><a href="robots.txt.html#Final-server" class="headerlink" title="Final server"></a>Final server</h2><p>Install WireGuard using <a target="_blank" rel="noopener" href="https://github.com/angristan/wireguard-install">https://github.com/angristan/wireguard-install</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/angristan/wireguard-install/master/wireguard-install.sh</span><br><span class="line">chmod +x wireguard-install.sh</span><br><span class="line">./wireguard-install.sh</span><br></pre></td></tr></table></figure>

<p>The generated server configuration file <code>/etc/wireguard/wg0.conf</code> looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 10.66.66.1/24,fd42:42:42::1/64</span><br><span class="line">ListenPort = 51820</span><br><span class="line">PrivateKey = mNsFzYlqLAbgo5CiD3PUuhziLTq/huHJSa2GHfQd2nA=</span><br><span class="line">PostUp = iptables -I INPUT -p udp --dport 51820 -j ACCEPT</span><br><span class="line">PostUp = iptables -I FORWARD -i ens3 -o wg0 -j ACCEPT</span><br><span class="line">PostUp = iptables -I FORWARD -i wg0 -j ACCEPT</span><br><span class="line">PostUp = iptables -t nat -A POSTROUTING -o ens3 -j MASQUERADE</span><br><span class="line">PostUp = ip6tables -I FORWARD -i wg0 -j ACCEPT</span><br><span class="line">PostUp = ip6tables -t nat -A POSTROUTING -o ens3 -j MASQUERADE</span><br><span class="line">PostDown = iptables -D INPUT -p udp --dport 51820 -j ACCEPT</span><br><span class="line">PostDown = iptables -D FORWARD -i ens3 -o wg0 -j ACCEPT</span><br><span class="line">PostDown = iptables -D FORWARD -i wg0 -j ACCEPT</span><br><span class="line">PostDown = iptables -t nat -D POSTROUTING -o ens3 -j MASQUERADE</span><br><span class="line">PostDown = ip6tables -D FORWARD -i wg0 -j ACCEPT</span><br><span class="line">PostDown = ip6tables -t nat -D POSTROUTING -o ens3 -j MASQUERADE</span><br><span class="line"></span><br><span class="line">### Client ipad</span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = x3gUQWXY/xwDpnwYWnY74YaHiSedwpq8PO6JUkWKzCA=</span><br><span class="line">PresharedKey = a9gptxKx6tpSlBHJp26jGBgbCbwjJewXTQByq1gjuHo=</span><br><span class="line">AllowedIPs = 10.66.66.2/32,fd42:42:42::2/128</span><br></pre></td></tr></table></figure>

<p>The generated client configuration file <code>/root/wg0-client-ipad.conf</code>, original and unaltered, looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">PrivateKey = cJ+nZUGp83hV/KSysP91YpahDJ293wiiQ6TZRrDiT3k=</span><br><span class="line">Address = 10.66.66.2/32,fd42:42:42::2/128</span><br><span class="line">DNS = 1.1.1.1,1.0.0.1</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = t6JhTWXw2HXVgiY8NW2AZfugQd5KYZmq18d3AFwcECs=</span><br><span class="line">PresharedKey = a9gptxKx6tpSlBHJp26jGBgbCbwjJewXTQByq1gjuHo=</span><br><span class="line">Endpoint = FINAL.SERVER.IP.ADDRESS:51820</span><br><span class="line">AllowedIPs = 0.0.0.0/0,::/0</span><br></pre></td></tr></table></figure>

<p>Install Xray from <a target="_blank" rel="noopener" href="https://github.com/XTLS/Xray-install">https://github.com/XTLS/Xray-install</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)&quot; @ install --beta -u root</span><br></pre></td></tr></table></figure>

<p>Generate UUID:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray uuid</span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6a0ce07a-6e2c-43a1-9e46-db287f74d34a</span><br></pre></td></tr></table></figure>

<p>Generate public-private key pair:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray x25519</span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Private key: 4JLxQQ9axlmz5sRAGvxwV4zSOiA-uwUfLc0HuGT6RH4</span><br><span class="line">Public key: JglJK7YsfQYWfGFqIs9r9Uz8WPxjReiqYFFeISielg4</span><br></pre></td></tr></table></figure>

<p>Generate short id:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rand -hex 8</span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2f35d1c3636c2b2e</span><br></pre></td></tr></table></figure>

<p>Edit the Xray server configuration file <code>/usr/local/etc/xray/config.json</code> and make it look like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log&quot;: &#123;</span><br><span class="line">        &quot;loglevel&quot;: &quot;warning&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;listen&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;port&quot;: 443,</span><br><span class="line">            &quot;protocol&quot;: &quot;vless&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;clients&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: &quot;6a0ce07a-6e2c-43a1-9e46-db287f74d34a&quot;,</span><br><span class="line">                        &quot;flow&quot;: &quot;&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                &quot;decryption&quot;: &quot;none&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;streamSettings&quot;: &#123;</span><br><span class="line">                &quot;network&quot;: &quot;h2&quot;,</span><br><span class="line">                &quot;security&quot;: &quot;reality&quot;,</span><br><span class="line">                &quot;realitySettings&quot;: &#123;</span><br><span class="line">                    &quot;show&quot;: false,</span><br><span class="line">                    &quot;dest&quot;: &quot;www.cisco.com:443&quot;,</span><br><span class="line">                    &quot;xver&quot;: 0,</span><br><span class="line">                    &quot;serverNames&quot;: [ </span><br><span class="line">                        &quot;www.cisco.com&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;privateKey&quot;: &quot;4JLxQQ9axlmz5sRAGvxwV4zSOiA-uwUfLc0HuGT6RH4&quot;,</span><br><span class="line">                    &quot;shortIds&quot;: [ </span><br><span class="line">                        &quot;2f35d1c3636c2b2e&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">            &quot;tag&quot;: &quot;direct&quot;,</span><br><span class="line">            &quot;redirect&quot;: &quot;127.0.0.1:51820&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Restart the Xray systemd service with this configuration file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart xray</span><br></pre></td></tr></table></figure>

<p>Open port <code>tcp/443</code> in this server’s firewall.</p>
<p>You now have Xray listening on <code>tcp/443</code> and WireGuard listening on <code>udp/51820</code> (which need not be open in this server’s firewall).</p>
<h2 id="Relay-server"><a href="robots.txt.html#Relay-server" class="headerlink" title="Relay server"></a>Relay server</h2><p>Install Xray from <a target="_blank" rel="noopener" href="https://github.com/XTLS/Xray-install">https://github.com/XTLS/Xray-install</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)&quot; @ install --beta -u root</span><br></pre></td></tr></table></figure>

<p>Edit the Xray server configuration file <code>/usr/local/etc/xray/config.json</code> and make it look like this. Note that the Xray client will accept <code>dokodemo-door</code> input on port <code>udp/51820</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log&quot;: &#123;</span><br><span class="line">        &quot;loglevel&quot;: &quot;warning&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;tag&quot;:&quot;wireguard&quot;,</span><br><span class="line">            &quot;port&quot;: 51820,</span><br><span class="line">            &quot;protocol&quot;:&quot;dokodemo-door&quot;,</span><br><span class="line">            &quot;settings&quot;:&#123;</span><br><span class="line">                &quot;address&quot;:&quot;0.0.0.0&quot;,</span><br><span class="line">                &quot;port&quot;:51820,</span><br><span class="line">                &quot;network&quot;:&quot;udp&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;vless&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;vnext&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;address&quot;: &quot;FINAL.SERVER.IP.ADDRESS&quot;,</span><br><span class="line">                        &quot;port&quot;: 443,</span><br><span class="line">                        &quot;users&quot;: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                &quot;id&quot;: &quot;6a0ce07a-6e2c-43a1-9e46-db287f74d34a&quot;,</span><br><span class="line">                                &quot;encryption&quot;: &quot;none&quot;,</span><br><span class="line">                                &quot;flow&quot;: &quot;&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;streamSettings&quot;: &#123;</span><br><span class="line">                &quot;network&quot;: &quot;h2&quot;,</span><br><span class="line">                &quot;security&quot;: &quot;reality&quot;,</span><br><span class="line">                &quot;realitySettings&quot;: &#123;</span><br><span class="line">                    &quot;show&quot;: false,</span><br><span class="line">                    &quot;fingerprint&quot;: &quot;chrome&quot;,</span><br><span class="line">                    &quot;serverName&quot;: &quot;www.cisco.com&quot;,</span><br><span class="line">                    &quot;publicKey&quot;: &quot;JglJK7YsfQYWfGFqIs9r9Uz8WPxjReiqYFFeISielg4&quot;,</span><br><span class="line">                    &quot;shortId&quot;: &quot;2f35d1c3636c2b2e&quot;, </span><br><span class="line">                    &quot;spiderX&quot;: &quot;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;tag&quot;: &quot;proxy&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Restart the Xray systemd service with this configuration file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart xray</span><br></pre></td></tr></table></figure>

<p>Open port <code>udp/51820</code> in this server’s firewall. </p>
<p>This server is now listening for public input on <code>udp/51820</code>, and whatever it gets will be sent by <code>dokodemo-door</code> to the Xray server.</p>
<h2 id="Client-device"><a href="robots.txt.html#Client-device" class="headerlink" title="Client device"></a>Client device</h2><p>Securely download the generated client configuration file from the final server. </p>
<p>Edit the apparent destination to be your relay server IP address, not your final server IP address:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">PrivateKey = cJ+nZUGp83hV/KSysP91YpahDJ293wiiQ6TZRrDiT3k=</span><br><span class="line">Address = 10.66.66.2/32,fd42:42:42::2/128</span><br><span class="line">DNS = 1.1.1.1,1.0.0.1</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = t6JhTWXw2HXVgiY8NW2AZfugQd5KYZmq18d3AFwcECs=</span><br><span class="line">PresharedKey = a9gptxKx6tpSlBHJp26jGBgbCbwjJewXTQByq1gjuHo=</span><br><span class="line">Endpoint = RELAY.SERVER.IP.ADDRESS:51820</span><br><span class="line">AllowedIPs = 0.0.0.0/0,::/0</span><br></pre></td></tr></table></figure>

<p>If you have not already done so, install WireGuard on the client as per <a target="_blank" rel="noopener" href="https://www.wireguard.com/install">https://www.wireguard.com/install</a>.</p>
<p>Add a tunnel (i.e., your edited configuration file).</p>
<p>Connect your client to the relay server, which will in turn whisk your traffic over Xray to the final server.</p>
<p><img src="https://cscot.pages.dev/images/wireguard-ipad.png" alt="WireGuard client on an iPad"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/07/nekoray-hysteria2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/07/nekoray-hysteria2/" class="post-title-link" itemprop="url">NekoRay with Hysteria2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-07 01:01:01" itemprop="dateCreated datePublished" datetime="2023-09-07T01:01:01+00:00">2023-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>NekoRay version 3.20 adds support for Hysteria2.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/MatsuriDayo/nekoray">NekoRay</a> is a cross-platform GUI for managing connections to proxy servers. It is built on the Qt development framework for cross-platform applications. NekoRay currently supports Windows and Linux. Older versions supported macOS, but this was removed due to lack of a maintainer. If you are willing to fix and update the code, you are welcome to submit your Pull Request.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria">Hysteria2</a> uses a custom version of the QUIC (Quick UDP Internet Connections) protocol to deliver unparalleled performance over unreliable or lossy networks. The protocol is designed to masquerade as standard HTTP&#x2F;3 traffic, making it difficult to detect and block without widespread collateral damage. Hysteria2 is almost a complete rewrite of the original Hysteria, with a new protocol and new features. Version 2 documentation is at <a target="_blank" rel="noopener" href="https://v2.hysteria.network/">https://v2.hysteria.network</a>. Hysteria2 is not compatible with the original Hysteria, so users must choose either version 1 or version 2 for both client and server.</p>
<p>This post documents a procedure for using Hysteria2 on a Linux server and accessing it from a NekoRay client on Windows.</p>
<p>If you experience problems:</p>
<ul>
<li>For NekoRay problems, set the log level to debug (in <strong>Basic Settings</strong>) and create an issue on the GitHub <a target="_blank" rel="noopener" href="https://github.com/MatsuriDayo/nekoray/issues">Issues</a> page.</li>
<li>For Hysteria problems, see the <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/advanced/Troubleshooting">Troubleshooting</a> page, and if you still need support, go to the GitHub <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/issues">Issues</a> page.</li>
</ul>
<h2 id="Hysteria2-server"><a href="robots.txt.html#Hysteria2-server" class="headerlink" title="Hysteria2 server"></a>Hysteria2 server</h2><p>The main installation instructions for Hysteria2 are at <a target="_blank" rel="noopener" href="https://v2.hysteria.network/docs/getting-started/Installation">https://v2.hysteria.network/docs/getting-started/Installation</a>. This demonstration uses material from <a target="_blank" rel="noopener" href="https://github.com/chika0801/hysteria-install">https://github.com/chika0801/hysteria-install</a>. </p>
<p>The server in this scenario has 1 GB of RAM and runs Ubuntu 22.04. It is assumed that you SSH into your server as <code>root</code>.</p>
<p>You will need a domain name and a DNS record pointing from your hostname to your server IP address. Our examples use <code>vps.example.com</code> as the sample hostname.</p>
<p>When using standalone mode to apply for or renew a certificate, the script will listen on port <code>tcp/80</code>. If port <code>tcp/80</code> is occupied, the script will fail. Therefore nothing else should be listening on port <code>tcp/80</code>.</p>
<p>As well as opening port <code>tcp/80</code> in your firewall, you will also need to open port <code>udp/443</code> for the Hysteria server. <strong>Note that Hysteria uses UDP.</strong></p>
<p>Set up the ACME script ready to request a free SSL certificate and private key from Let’s Encrypt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y socat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias acme.sh=~/.acme.sh/acme.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure>

<p>Request a free Elliptic Curve Cryptography certificate for your hostname in standalone mode. Change <code>vps.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d vps.example.com --standalone --keylength ec-256</span><br></pre></td></tr></table></figure>

<p>Install the SSL certificate and key to the <code>/etc/ssl/private</code> directory. Change <code>vps.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d vps.example.com --ecc --fullchain-file /etc/ssl/private/fullchain.cer --key-file /etc/ssl/private/private.key</span><br></pre></td></tr></table></figure>

<p>Force certificate renewal. Change <code>vps.example.com</code> to your real hostname in this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --renew -d vps.example.com --force --ecc</span><br></pre></td></tr></table></figure>

<p>Install the Hysteria program on your server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /root/hysteria https://github.com/apernet/hysteria/releases/latest/download/hysteria-linux-amd64 &amp;&amp; chmod +x /root/hysteria &amp;&amp; mv -f /root/hysteria /usr/local/bin</span><br></pre></td></tr></table></figure>

<p>Check the installation of Hysteria2 has worked:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hysteria version</span><br></pre></td></tr></table></figure>

<p>Download the configuration template:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /root/hysteria_config.yaml https://raw.githubusercontent.com/chika0801/hysteria-install/main/config_server.yaml</span><br></pre></td></tr></table></figure>

<p>Edit the configuration file. If you use the <code>vi</code> editor:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/hysteria_config.yaml</span><br></pre></td></tr></table></figure>

<p>If you use the <code>nano</code> editor:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/hysteria_config.yaml</span><br></pre></td></tr></table></figure>

<p>Change at least the TLS locations and the password. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">listen: :443</span><br><span class="line"></span><br><span class="line">tls:</span><br><span class="line">  cert: /etc/ssl/private/fullchain.cer</span><br><span class="line">  key: /etc/ssl/private/private.key</span><br><span class="line"></span><br><span class="line">auth:</span><br><span class="line">  type: password</span><br><span class="line">  password: gnxMEu8zV5XMPTv9</span><br><span class="line"></span><br><span class="line">resolver:</span><br><span class="line">  type: https</span><br><span class="line">  https:</span><br><span class="line">    addr: 1.1.1.1:443</span><br><span class="line">    timeout: 10s</span><br><span class="line"></span><br><span class="line">acl:</span><br><span class="line">  inline:</span><br><span class="line">    - reject(all, udp/443)</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<p>Download the systemd service file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo /etc/systemd/system/hysteria.service https://raw.githubusercontent.com/chika0801/hysteria-install/main/hysteria.service &amp;&amp; systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>Start the service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable hysteria</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start hysteria</span><br></pre></td></tr></table></figure>

<p>Check that Hysteria is <code>active (running)</code> on the server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status hysteria</span><br></pre></td></tr></table></figure>

<p>If necessary, check the log:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -u hysteria</span><br></pre></td></tr></table></figure>

<p>Check that Hysteria is listening on port <code>udp/443</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tulpn</span><br></pre></td></tr></table></figure>

<h2 id="NekoRay-client"><a href="robots.txt.html#NekoRay-client" class="headerlink" title="NekoRay client"></a>NekoRay client</h2><p>Go to the <a target="_blank" rel="noopener" href="https://github.com/MatsuriDayo/nekoray/releases">NekoRay releases</a> page on GitHub.</p>
<p>Download version 3.20 or later, e.g. <code>nekoray-3.20-2023-09-07-windows64.zip</code>. </p>
<p>Extract the archive to give a folder <code>nekoray-3.20-2023-09-07-windows64\nekoray</code>.</p>
<p>The first time you run <code>nekoray.exe</code>, you may see Windows Defender SmartScreen. Allow the program to <strong>Run anyway</strong>.</p>
<p>You are asked to decide whether you want to use Xray or sing-box as your core. Xray is widely used and has good compatibility with other protocols and clients. More new protocols are supported by sing-box, and in some cases these give better performance. </p>
<p>Since this scenario uses Hysteria2, choose <code>sing-box</code> as your core.</p>
<p>The GUI appears.</p>
<p><img src="https://cscot.pages.dev/images/nekoray1.png" alt="Nekoray graphical user interface"></p>
<p>Look at the log pane at the bottom of the window. You need to see a message confirming you have at least <code>sing-box-extra</code> version <code>1.5.0</code> to support Hysteria2.</p>
<p>Notice that there is a <strong>Tun Mode</strong> and a <strong>System Proxy</strong> mode. You can enable either of these by checking the boxes at the top of the user interace. <strong>Tun Mode</strong> will proxy the traffic of the entire system, which is suitable for software that cannot or will not use the <strong>System Proxy</strong>. Browsers can use the <strong>System Proxy</strong> setting. </p>
<p>In this scenario, check the box for <strong>System Proxy</strong>.</p>
<p>If you want to check the proxy settings in NekoRay, go to <strong>Preferences</strong> &gt; <strong>Basic Settings</strong> &gt; <strong>Common</strong>, you will see that once you connect, a combined SOCKS and HTTP proxy will start listening on localhost port <code>tcp/2080</code></p>
<p>Some other buttons to notice:</p>
<ul>
<li><strong>Server</strong> is where we will add the server in a moment.</li>
<li><strong>Ads</strong> takes you to unscreened airport ads at <a target="_blank" rel="noopener" href="https://matsuricom.pages.dev/">https://matsuricom.pages.dev</a></li>
<li><strong>Document</strong> takes you to <a target="_blank" rel="noopener" href="https://matsuridayo.github.io/">https://matsuridayo.github.io</a>.</li>
<li><strong>Update</strong> attempts to update the software.</li>
<li>You can reach the NekoRay context menu by right-clicking the NekoRay icon in the Windows system tray.</li>
</ul>
<p>In the NekoRay GUI, select <strong>Server</strong> then <strong>New profile</strong>.</p>
<p>Add the details of your server:</p>
<p><img src="https://cscot.pages.dev/images/nekoray2.png" alt="Nekoray server new profile"></p>
<p>Click <strong>OK</strong> to add the new server profile.</p>
<p>Select the server’s row, and press <strong>Enter</strong> to start the connection.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/04/standard-trouble-shooting-procedures/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/04/standard-trouble-shooting-procedures/" class="post-title-link" itemprop="url">Standard Troubleshooting Procedures</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-04 04:04:04" itemprop="dateCreated datePublished" datetime="2023-09-04T04:04:04+00:00">2023-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Here’s some simple ideas you can use to investigate problems with VPNs and proxy servers.</p>
<ol>
<li><p>Make sure the service is running on the server. Assuming your proxy server runs under systemd, that would mean issuing commands such as <code>systemctl status xray</code>, <code>systemctl status openvpn@server</code>, or <code>systemctl status tor@default</code> (these are just examples of <code>systemctl status</code> commands).</p>
</li>
<li><p>Review the logs on both ends of the connection (server and client). On the server, issue appropriate commands such as <code>journalctl -u xray</code> or <code>tail /var/log/nginx/error.log</code> (these are just examples), depending on what software you are running and how you are running it. Also view the logs on your client.</p>
</li>
<li><p>What is listening on the server and on what ports and protocols? Issue the command <code>ss -tulpn</code> and make sure the results are as expected. Is your server listening where you expect it to be listening?</p>
</li>
<li><p>Is your server IP address reacheable? Issue the <code>ping</code> command on the client.</p>
</li>
<li><p>If you are using TCP, is your TCP port reachable? Attempt to <code>telnet</code> to your TCP port. Can you reach that port, and does it let you connect?</p>
</li>
<li><p>Are packets arriving at your firewall as expected? <code>iptables</code> and <code>nftables</code> both allow you to count packets for each input port and protocol.</p>
</li>
<li><p>Double-check and triple-check that your configuration files match. You’d be amazed how many problems turn out to be due to mismatches between server configuration and client configuration.</p>
</li>
<li><p>Search for previous occurrences of any error messages in a search engine and on the GitHub issues tab for your software repository.</p>
</li>
<li><p>Run <code>tcpdump</code> on the server and make sure packets are arriving as your expect. The equivalent for GUI clients is Wireshark. Make sure the expected packets are going out to the expected destination.</p>
</li>
<li><p>If you’re going to ask for help, produce all the evidence you’ve collected so far, along with the complete instructions that someone else would need to recreate your environment (both server and client).</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/04/hysteria-udp-proxy-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/04/hysteria-udp-proxy-server/" class="post-title-link" itemprop="url">Hysteria UDP Proxy Server</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-04 03:03:03" itemprop="dateCreated datePublished" datetime="2023-09-04T03:03:03+00:00">2023-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>This post is about how to install the current version of Hysteria, whose GitHub repo is at <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria">https://github.com/apernet/hysteria</a>. For a preview of Hysteria 2, see <a target="_blank" rel="noopener" href="https://github.com/chika0801/hysteria-install">https://github.com/chika0801/hysteria-install</a>.</p>
<h2 id="Server"><a href="robots.txt.html#Server" class="headerlink" title="Server"></a>Server</h2><h3 id="Domain-name"><a href="robots.txt.html#Domain-name" class="headerlink" title="Domain name"></a>Domain name</h3><p>You need to purchase a domain name (e.g. <code>example.com</code>). </p>
<p>Point the hostname (e.g. <code>vps.example.com</code>) to your VPS IP address. Wait about 2-5 minutes for DNS resolution to take effect. You can check whether the returned IP address is correct by pinging the hostname you set. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping vps.example.com</span><br></pre></td></tr></table></figure>

<h3 id="Firewall"><a href="robots.txt.html#Firewall" class="headerlink" title="Firewall"></a>Firewall</h3><p>Open ports in your server firewall:</p>
<ul>
<li><code>tcp/80</code> for ACME to use to apply for or renew your SSL certificate</li>
<li><code>udp/36712</code> for Hysteria (change the port number from this default, of course)</li>
</ul>
<h3 id="SSL-certificate-and-key"><a href="robots.txt.html#SSL-certificate-and-key" class="headerlink" title="SSL certificate and key"></a>SSL certificate and key</h3><p>When using standalone mode to apply for or renew a certificate, the script will listen on port <code>tcp/80</code>. If port <code>tcp/80</code> is occupied, the script will fail. Therefore nothing else should be listening on port <code>tcp/80</code>.</p>
<p>In the sample commands below</p>
<p>Install the ACME shell script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y socat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br></pre></td></tr></table></figure>

<p>Set a shorter alias for the ACME shell script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias acme.sh=~/.acme.sh/acme.sh</span><br></pre></td></tr></table></figure>

<p>Set up ACME shell script auto-update:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --upgrade --auto-upgrade</span><br></pre></td></tr></table></figure>

<p>Change the default Certificate Authority to Let’s Encrypt:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --set-default-ca --server letsencrypt</span><br></pre></td></tr></table></figure>

<p>Apply for an Elliptic Curve Cryptography certificate for <code>vps.example.com</code> in standalone mode:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d vps.example.com --standalone --keylength ec-256</span><br></pre></td></tr></table></figure>

<p>Install the <code>vps.example.com</code> certificate to the &#x2F;etc&#x2F;ssl&#x2F;private directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --install-cert -d vps.example.com --ecc --fullchain-file /etc/ssl/private/fullchain.cer --key-file /etc/ssl/private/private.key</span><br></pre></td></tr></table></figure>

<p>Force certificate renewal:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --renew -d vps.example.com --force --ecc</span><br></pre></td></tr></table></figure>

<h3 id="Program"><a href="robots.txt.html#Program" class="headerlink" title="Program"></a>Program</h3><p>Download the latest release of program <code>hysteria-linux-amd64</code> from <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/releases">https://github.com/apernet/hysteria/releases</a>, e.g. for <code>v1.3.5</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/apernet/hysteria/releases/download/v1.3.5/hysteria-linux-amd64</span><br></pre></td></tr></table></figure>

<p>Copy <code>hysteria-linux-amd64</code> under the name <code>hysteria</code> into the <code>/usr/local/bin</code> directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp hysteria-linux-amd64 /usr/local/bin/hysteria </span><br></pre></td></tr></table></figure>

<p>Assign execute permission:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/bin/hysteria</span><br></pre></td></tr></table></figure>

<h3 id="Configuration"><a href="robots.txt.html#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>Generate a strong password from <a target="_blank" rel="noopener" href="https://passwordsgenerator.net/">https://passwordsgenerator.net</a>, e.g. <code>46D3SMTTbUkGNMTYbpZ3tzTE</code>.</p>
<p>Create a new file <code>config.json</code> like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;listen&quot;: &quot;:36712&quot;,</span><br><span class="line">  &quot;cert&quot;: &quot;/etc/ssl/private/fullchain.cer&quot;,</span><br><span class="line">  &quot;key&quot;: &quot;/etc/ssl/private/private.key&quot;, </span><br><span class="line">  &quot;obfs&quot;: &quot;46D3SMTTbUkGNMTYbpZ3tzTE&quot;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The documentation for Hysteria configuration is at <a target="_blank" rel="noopener" href="https://hysteria.network/">https://hysteria.network</a></p>
<h3 id="Service"><a href="robots.txt.html#Service" class="headerlink" title="Service"></a>Service</h3><p>Create a new file <code>/etc/systemd/system/hysteria.service</code>.</p>
<p>Model your systemd service file on the example at <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/chika0801/hysteria-install/main/hysteria.service">https://raw.githubusercontent.com/chika0801/hysteria-install/main/hysteria.service</a> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">After=network.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">WorkingDirectory=/root</span><br><span class="line">CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW</span><br><span class="line">AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW</span><br><span class="line">ExecStart=/usr/local/bin/hysteria -c /root/config.json server</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>Reload the systemd daemon:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<p>Start the service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable hysteria</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start hysteria</span><br></pre></td></tr></table></figure>

<h2 id="Client"><a href="robots.txt.html#Client" class="headerlink" title="Client"></a>Client</h2><p>Our client here is Windows.</p>
<p>Download the latest release of program <code>hysteria-windows-amd64.exe</code> from <a target="_blank" rel="noopener" href="https://github.com/apernet/hysteria/releases">https://github.com/apernet/hysteria/releases</a>.</p>
<p>Create a configuration file <code>Downloads\config.json</code> that looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;server&quot;: &quot;vps.example.com:36712&quot;,</span><br><span class="line">  &quot;obfs&quot;: &quot;46D3SMTTbUkGNMTYbpZ3tzTE&quot;,</span><br><span class="line">  &quot;up_mbps&quot;: 10,</span><br><span class="line">  &quot;down_mbps&quot;: 50,</span><br><span class="line">  &quot;socks5&quot;: &#123;</span><br><span class="line">    &quot;listen&quot;: &quot;127.0.0.1:10808&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;http&quot;: &#123;</span><br><span class="line">    &quot;listen&quot;: &quot;127.0.0.1:10809&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>up_mbps</code> and <code>down_mbps</code> are mandatory on the client side. They should reflect the bandwidth of your current network as accurately as possible.</p>
<p>Save the file.</p>
<p>Open a Command Prompt window and start the program running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\hysteria-windows-amd64.exe</span><br></pre></td></tr></table></figure>

<p>The messages should include something like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Client configuration loaded</span><br><span class="line">[INFO] [addr:vps.example.com:36712] Connected</span><br><span class="line">[INFO] [addr:127.0.0.1:10809] HTTP server up and running</span><br><span class="line">[INFO] [addr:127.0.0.1:10808] SOCKS5 server up and running</span><br></pre></td></tr></table></figure>

<p>Leave the Command Prompt window open with the program running in it.</p>
<p>If you have not already done so, install <a target="_blank" rel="noopener" href="https://www.mozilla.org/">Mozilla Firefox</a>.</p>
<p>From the Firefox hamburger menu, select <strong>Settings</strong>. On the <strong>General</strong> page, scroll down to where it says <strong>Network Settings</strong>. Click the <strong>Settings</strong> button.</p>
<ul>
<li>Select <strong>Manual proxy configuration</strong></li>
<li>Set SOCKS Host to <code>127.0.0.1</code></li>
<li>Set Port to <code>10808</code></li>
<li>Select <strong>SOCKS v5</strong></li>
<li>Select <strong>Proxy DNS when using SOCKS v5</strong></li>
</ul>
<p>Click <strong>OK</strong>.</p>
<p>Test your set-up by visiting websites in Firefox.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/04/obfuscate-wireguard-shadowsocks-v2ray/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/04/obfuscate-wireguard-shadowsocks-v2ray/" class="post-title-link" itemprop="url">Obfuscate WireGuard with Shadowsocks using V2Ray</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-04 02:02:02" itemprop="dateCreated datePublished" datetime="2023-09-04T02:02:02+00:00">2023-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://cscot.pages.dev/images/obfuscated-wireguard.png" alt="Obfuscated WireGuard GUI on Windows"></p>
<h2 id="Install-WireGuard-on-server"><a href="robots.txt.html#Install-WireGuard-on-server" class="headerlink" title="Install WireGuard on server"></a>Install WireGuard on server</h2><p>There are many ways to install WireGuard on a server. Someone else may already have set up a server for you. If you are setting up the WireGuard server yourself, one quick way is to use an <a target="_blank" rel="noopener" href="https://github.com/angristan/wireguard-install">installation script</a>. It generates both the server configuration and the client configuration for you.</p>
<p>If you are going to use that script, then just execute these three commands from the <a target="_blank" rel="noopener" href="https://github.com/angristan/wireguard-install/blob/master/README.md">README</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/angristan/wireguard-install/master/wireguard-install.sh</span><br><span class="line">chmod +x wireguard-install.sh</span><br><span class="line">./wireguard-install.sh</span><br></pre></td></tr></table></figure>

<p>You must make a note of the randomly generated port number with this script. Our example will be <code>56051</code>. You’ll need to know the WireGuard listening port number when you configure the client.</p>
<p>At the end of the script’s run, you can check the status of the systemd service with the command <code>systemctl status wg-quick@wg0</code>.</p>
<h2 id="Install-V2Ray-on-server"><a href="robots.txt.html#Install-V2Ray-on-server" class="headerlink" title="Install V2Ray on server"></a>Install V2Ray on server</h2><p>As with WireGuard, it is quicker to use a script for the installation. This tutorial uses the official V2Ray installation script from <a target="_blank" rel="noopener" href="https://github.com/v2fly/fhs-install-v2ray">https://github.com/v2fly/fhs-install-v2ray</a>. Run the following command to download and run the script on your server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)</span><br></pre></td></tr></table></figure>

<p>The script will provide information such as information, warning, and error messages when it is executed. Please read them carefully.</p>
<p>For the answer to common problems, consult the <a target="_blank" rel="noopener" href="https://github.com/v2fly/fhs-install-v2ray/wiki">wiki</a>. If your question is not listed, you are welcome to raise it on the <a target="_blank" rel="noopener" href="https://github.com/v2fly/v2ray-core/issues">Issues</a> tab. Please read <a target="_blank" rel="noopener" href="https://github.com/v2fly/fhs-install-v2ray/issues/63">Issue #63</a> before asking a question, otherwise it may not be answered.</p>
<p>The script does <em>not</em> automatically generate configuration files for you; it only solves problems encountered during the installation phase. We are going to code  our own configuration file below. Please refer to the <a target="_blank" rel="noopener" href="https://www.v2fly.org/en_US/v5/config/overview.html">documentation</a> to understand the syntax of the configuration file. You can also refer to <a target="_blank" rel="noopener" href="https://github.com/v2fly/v2ray-examples">configuration file templates</a> contributed by the community. Note that these templates need to be modified and adjusted by yourself after copying and cannot be used directly.</p>
<p>It is not recommended to use the script to install V2Ray in Docker. Please use the official Docker image directly. If the official Docker image cannot meet your custom installation needs, please fork and modify the upstream Dockerfile.</p>
<p>The files installed by the script conform to the Filesystem Hierarchy Standard (FHS):</p>
<ul>
<li><code>/usr/local/bin/v2ray</code></li>
<li><code>/usr/local/bin/v2ctl</code></li>
<li><code>/usr/local/share/v2ray/geoip.dat</code></li>
<li><code>/usr/local/share/v2ray/geosite.dat</code></li>
<li><code>/usr/local/etc/v2ray/config.json</code></li>
<li><code>/var/log/v2ray/access.log</code></li>
<li><code>/var/log/v2ray/error.log</code></li>
<li><code>/etc/systemd/system/v2ray.service</code></li>
<li><code>/etc/systemd/system/v2ray@.service</code></li>
</ul>
<h2 id="Configure-V2Ray-on-server"><a href="robots.txt.html#Configure-V2Ray-on-server" class="headerlink" title="Configure V2Ray on server"></a>Configure V2Ray on server</h2><p>The V2Ray server will accept input in Shadowsocks format and send it to WireGuard running on the same server.</p>
<p>A convenient way to generate a password is to use <a target="_blank" rel="noopener" href="https://passwordsgenerator.net/">https://passwordsgenerator.net</a>.</p>
<p>Our example password below is <code>%R#5&lt;eA#ex~ZXuqR</code>, but you must change this to your own choice of password.</p>
<p>Our example port is <code>1234</code>, but again you must change this to your own choice of port number.</p>
<p>Edit the configuration file <code>/usr/local/etc/v2ray/config.json</code>, using what follows as a template:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;listen&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;port&quot;: 1234,</span><br><span class="line">            &quot;protocol&quot;: &quot;shadowsocks&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;method&quot;: &quot;chacha20-ietf-poly1305&quot;,</span><br><span class="line">                &quot;password&quot;: &quot;%R#5&lt;eA#ex~ZXuqR&quot;,</span><br><span class="line">                &quot;network&quot;:  &quot;udp&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">            &quot;tag&quot;: &quot;direct&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Start V2Ray with your new configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable v2ray</span><br><span class="line">systemctl start v2ray</span><br></pre></td></tr></table></figure>

<h2 id="Open-server-firewall"><a href="robots.txt.html#Open-server-firewall" class="headerlink" title="Open server firewall"></a>Open server firewall</h2><p>Open the corresponding port, which is <code>udp/1234</code> in the example, in your server firewall. Some cloud providers call the firewall “security groups.” </p>
<h2 id="Create-V2Ray-client-configuration"><a href="robots.txt.html#Create-V2Ray-client-configuration" class="headerlink" title="Create V2Ray client configuration"></a>Create V2Ray client configuration</h2><p>Create a configuration file.</p>
<p>This configuration uses <code>dokodemo-door</code>. Dokodemo Door is Japanese for the “Anywhere Door” (どこでもドア) which has appeared in certain manga and video games. In V2Ray terms, <code>dokodemo-door</code> is an inbound protocol. It listens on a local port and sends all traffic entering this port to a specified port number on the server. It is similar to port forwarding.</p>
<p>Replace <code>56051</code> in the template below by your WireGuard listening port.</p>
<p>Replace <code>&#123;&#123; host &#125;&#125;</code> by your server IP address.</p>
<p>Replace <code>%R#5&lt;eA#ex~ZXuqR</code> by your password.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;tag&quot;:&quot;wireguard&quot;,</span><br><span class="line">            &quot;port&quot;: 56051,</span><br><span class="line">            &quot;protocol&quot;:&quot;dokodemo-door&quot;,</span><br><span class="line">            &quot;settings&quot;:&#123;</span><br><span class="line">                &quot;address&quot;:&quot;127.0.0.1&quot;,</span><br><span class="line">                &quot;port&quot;:56051,</span><br><span class="line">                &quot;network&quot;:&quot;udp&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;shadowsocks&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;servers&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;address&quot;: &quot;&#123;&#123; host &#125;&#125;&quot;,</span><br><span class="line">                        &quot;port&quot;: 1234,</span><br><span class="line">                        &quot;method&quot;: &quot;chacha20-ietf-poly1305&quot;,</span><br><span class="line">                        &quot;password&quot;: &quot;%R#5&lt;eA#ex~ZXuqR&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;tag&quot;: &quot;proxy&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Save the file.</p>
<h2 id="Install-V2Ray-command-line-client"><a href="robots.txt.html#Install-V2Ray-command-line-client" class="headerlink" title="Install V2Ray command-line client"></a>Install V2Ray command-line client</h2><p>You can get the command-line client for many different platforms from <a target="_blank" rel="noopener" href="https://github.com/v2fly/v2ray-core/releases">https://github.com/v2fly/v2ray-core/releases</a>. </p>
<p>For Windows the client is named <code>v2ray-windows-64.zip</code>. Unzip the <code>.zip</code> file.</p>
<h2 id="Run-V2Ray-command-line-client"><a href="robots.txt.html#Run-V2Ray-command-line-client" class="headerlink" title="Run V2Ray command-line client"></a>Run V2Ray command-line client</h2><p>Open a Command Prompt.</p>
<p>Change into the directory with your V2Ray application and configuration file in it. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads\v2ray-windows-64</span><br></pre></td></tr></table></figure>

<p>Run V2Ray with your configuration file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\v2ray.exe run -c config.json</span><br></pre></td></tr></table></figure>

<p>Leave the Command Prompt window open with V2Ray running in it.</p>
<h2 id="Route-server-IP-address-directly"><a href="robots.txt.html#Route-server-IP-address-directly" class="headerlink" title="Route server IP address directly"></a>Route server IP address directly</h2><p>Use the calculator at <a target="_blank" rel="noopener" href="https://www.procustodibus.com/blog/2021/03/wireguard-allowedips-calculator">https://www.procustodibus.com/blog/2021/03/wireguard-allowedips-calculator</a> to calculate the expression for all possible IP addresses <em>except</em> your server IP address.</p>
<ul>
<li>Set <strong>Allowed IPs</strong> to <code>0.0.0.0/0,::/0</code></li>
<li>Set <strong>Disallowed</strong> IPs to your server’s IP address</li>
<li>Press <strong>Calculate</strong></li>
</ul>
<p>Edit your WireGuard client configuration file.</p>
<p>Replace your client’s original <code>AllowedIPs</code> line with the one from the calculator.</p>
<p>Most important – also change the <code>Endpoint</code> so that it points to localhost, e.g.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Endpoint = 127.0.0.1:56051</span><br></pre></td></tr></table></figure>

<p>Save the amended WireGuard client configuration file.</p>
<p><img src="https://cscot.pages.dev/images/obfuscated-wireguard.png" alt="Obfuscated WireGuard GUI on Windows"></p>
<h2 id="Install-WireGuard-on-client"><a href="robots.txt.html#Install-WireGuard-on-client" class="headerlink" title="Install WireGuard on client"></a>Install WireGuard on client</h2><p>Install your WireGuard client from <a target="_blank" rel="noopener" href="https://www.wireguard.com/install">https://www.wireguard.com/install</a>.</p>
<p>Import your amended WireGuard client configuration file (called <strong>“Add Tunnel</strong> in the Windows GUI).</p>
<p>If you are using the Windows GUI, uncheck the box for <strong>Block untunneled traffic (kill switch)</strong>.</p>
<p>Activate the tunnel.</p>
<h2 id="Smoke-test"><a href="robots.txt.html#Smoke-test" class="headerlink" title="Smoke test"></a>Smoke test</h2><p>Open a browser and test your end-to-end connection.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/09/04/build-openvpn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/09/04/build-openvpn/" class="post-title-link" itemprop="url">How to build OpenVPN from source</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-09-04 01:01:01" itemprop="dateCreated datePublished" datetime="2023-09-04T01:01:01+00:00">2023-09-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>OpenVPN is widely used cross-platform VPN software, originally written by James Yonan in 2001, and now available for Linux, Windows, macOS, Android, iOS, and other platforms.</p>
<p>Here is how to build OpenVPN from source on a Linux server and a Windows client.</p>
<p>The OpenVPN source code for the current release is stored at <a target="_blank" rel="noopener" href="https://github.com/OpenVPN/openvpn">https://github.com/OpenVPN/openvpn</a>.</p>
<p>The source code for this release and previous releases is stored at <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads">https://openvpn.net/community-downloads</a>.</p>
<p>Determine which release you will build. </p>
<p>Our examples use release <code>2.6.6</code>.</p>
<h2 id="Linux"><a href="robots.txt.html#Linux" class="headerlink" title="Linux"></a>Linux</h2><ol>
<li>Download the OpenVPN compressed tarball from <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads">https://openvpn.net/community-downloads</a>. In our example:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://swupdate.openvpn.org/community/releases/openvpn-2.6.6.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf openvpn-2.6.6.tar.gz</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Install the prerequisites for the build:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y build-essential libssl-dev iproute2 liblz4-dev liblzo2-dev libpam0g-dev libpkcs11-helper1-dev libsystemd-dev resolvconf pkg-config autoconf automake libtool libcap-ng-dev</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Build and install OpenVPN:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd openvpn-2.6.6</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autoreconf -i -v -f</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --enable-systemd --enable-async-push --enable-iproute2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Do an initial check of the binary:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/sbin</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./openvpn --version</span><br></pre></td></tr></table></figure>

<h2 id="Windows"><a href="robots.txt.html#Windows" class="headerlink" title="Windows"></a>Windows</h2><ol>
<li><p>Install Git from <a target="_blank" rel="noopener" href="https://git-scm.com/download/win">https://git-scm.com/download/win</a>.</p>
</li>
<li><p>Install Visual Studio 2022 community edition from <a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/vs/community">https://visualstudio.microsoft.com/vs/community</a>.</p>
</li>
<li><p>Visit <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads">https://openvpn.net/community-downloads</a> and download the OpenVPN source archive version <code>2.6.6</code>.</p>
</li>
<li><p>Use <a target="_blank" rel="noopener" href="https://www.7-zip.org/">7-Zip</a> to extract compressed tarball <code>openvpn-2.6.6.tar.gz</code> into <code>openvpn-2.6.6.tar</code>. Then extract <code>openvpn-2.6.6.tar</code> to give folder <code>openvpn-2.6.6</code>.</p>
</li>
<li><p>Open <strong>Start</strong> &gt; <strong>Visual Studio 2022</strong> &gt;  <strong>Developer Command Prompt for VS 2022</strong>. </p>
</li>
<li><p>In the Developer Command Prompt for VS 2022, install the Microsoft C&#x2F;C++ dependency manager:</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /d %USERPROFILE%</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/microsoft/vcpkg.git</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd vcpkg</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootstrap-vcpkg.bat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg integrate install</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>In the Developer Command Prompt for VS 2022, build OpenVPN:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /d %USERPROFILE%</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads\openvpn-2.6.6</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msbuild /p:Configuration=Release /p:Platform=x64</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>In a regular Command Prompt window, do an initial check of the binary:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd Downloads\openvpn-2.6.6\x64-Output\Release</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\openvpn.exe --version</span><br></pre></td></tr></table></figure>


<h2 id="Testing"><a href="robots.txt.html#Testing" class="headerlink" title="Testing"></a>Testing</h2><ol>
<li>The easiest way to create a testbed on the server is to download and run the @angristan script:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O https://raw.githubusercontent.com/angristan/openvpn-install/master/openvpn-install.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x openvpn-install.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./openvpn-install.sh</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Prevent APT from upgrading the OpenVPN package that came from the repositories:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-mark hold openvpn</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>Edit the systemd service file <code>/etc/systemd/system/openvpn@.service</code>. Change the executable from <code>/usr/sbin/openvpn</code> to <code>/usr/local/sbin/openvpn</code>. </p>
</li>
<li><p>After saving the file, reload the systemd daemon:</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>Restart OpenVPN with your own binary:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart openvpn@server</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>On a Windows PC client, download the OpenVPN client configuration file that you generated on the server. Open PowerShell and issue the command:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp root@YOUR.SERVER.IP.ADDRESS:xxxxxxxx.ovpn Downloads</span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p>Download and run the standard OpenVPN installer from <a target="_blank" rel="noopener" href="https://openvpn.net/community-downloads">https://openvpn.net/community-downloads</a>. There is no problem if it gives a message at the end of the install to say that there are no connection profiles (configuration files) yet.</p>
</li>
<li><p>In the OpenVPN GUI, change the <strong>Settings</strong> so that it does not launch on user logon.</p>
</li>
<li><p>Exit the OpenVPN GUI.</p>
</li>
<li><p>Copy the  <code>xxxxxxxx.ovpn</code> client configuration file from <code>Downloads</code> into <code>Downloads\openvpn-2.6.6\x64-Output\Release</code>.</p>
</li>
<li><p>Run your binary by opening a Command Prompt with <strong>Run as Administrator</strong> and issuing the commands:</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Users\YOURUSERNAME\Downloads\openvpn-2.6.6\x64-Output\Release</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\openvpn.exe --config xxxxxxxx.ovpn</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://cscot.pages.dev/2023/07/10/v2ray-geoip-iran/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Computer Scot">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cscot">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | cscot">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="https://cscot.pages.dev/2023/07/10/v2ray-geoip-iran/" class="post-title-link" itemprop="url">V2Ray GeoIP for Iran</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-10 18:00:00" itemprop="dateCreated datePublished" datetime="2023-07-10T18:00:00+00:00">2023-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-28 10:52:36" itemprop="dateModified" datetime="2023-09-28T10:52:36+00:00">2023-09-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>It is important that your proxy client not send packets to a proxy server when those packets are simply going to return to your own country. A firewall correlating packets can easily see that you are running a proxy server. Instead you must route domestic packets directly. </p>
<p>Domestic IP addresses are defined in the file <code>geoip.dat</code>. Unfortunately you cannot use the standard <code>geoip.dat</code>, because it does not include a section for Iran. If you try to use a rule such as <code>geoip:ir</code>, you will get an error. Instead you must generate your own <code>geoip.dat</code>. </p>
<p>This post shows you how.</p>
<h2 id="Sign-up-for-GeoLite2"><a href="robots.txt.html#Sign-up-for-GeoLite2" class="headerlink" title="Sign up for GeoLite2"></a>Sign up for GeoLite2</h2><p>You will need a free GeoLite2 account.</p>
<p>Open a browser and visit the MaxMind sign-up page:</p>
<p><a target="_blank" rel="noopener" href="https://www.maxmind.com/en/geolite2/signup">https://www.maxmind.com/en/geolite2/signup</a></p>
<p>Provide your email address and the other details requested.</p>
<p>A password reset link is sent to you by email. You can then log in to MaxMind with your email address and password.</p>
<h2 id="Download-GeoLite2-databases"><a href="robots.txt.html#Download-GeoLite2-databases" class="headerlink" title="Download GeoLite2 databases"></a>Download GeoLite2 databases</h2><p>Under <strong>Database Products and Subscriptions</strong>, click the link <strong>Download Databases</strong>.</p>
<p>The database you want is <code>GeoLite2 Country: CSV Format</code>.</p>
<p>Download the zip file. It has a name that looks like <code>GeoLite2-Country-CSV_YYYYMMDD.zip</code>.</p>
<p>Unzip the zip file.</p>
<p>The files you will need are:</p>
<ul>
<li><code>GeoLite2-Country-Locations-en.csv</code></li>
<li><code>GeoLite2-Country-Blocks-IPv4.csv</code></li>
<li><code>GeoLite2-Country-Blocks-IPv6.csv</code></li>
</ul>
<h2 id="Install-Git"><a href="robots.txt.html#Install-Git" class="headerlink" title="Install Git"></a>Install Git</h2><p>We assume you are working on a computer that runs Ubuntu Linux.</p>
<p>Install Git on your computer:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line">sudo apt install -y git</span><br></pre></td></tr></table></figure>

<h2 id="Install-Go-language"><a href="robots.txt.html#Install-Go-language" class="headerlink" title="Install Go language"></a>Install Go language</h2><p>Determine latest version of Go. We will use <code>1.20.5</code> in our examples.</p>
<p>Download and extract this version of Go:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /usr/local/go</span><br><span class="line">wget https://go.dev/dl/go1.20.5.linux-amd64.tar.gz</span><br><span class="line">sudo tar -C /usr/local -xzf go1.20.5.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p>Add Go to your path:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;export PATH=$PATH:/usr/local/go/bin&#x27; &gt;&gt; $HOME/.profile</span><br><span class="line">source $HOME/.profile</span><br></pre></td></tr></table></figure>

<p>Check your version of Go:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br></pre></td></tr></table></figure>

<h2 id="Clone-project-code"><a href="robots.txt.html#Clone-project-code" class="headerlink" title="Clone project code"></a>Clone project code</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/v2fly/geoip.git</span><br></pre></td></tr></table></figure>

<h2 id="Install-project-dependencies"><a href="robots.txt.html#Install-project-dependencies" class="headerlink" title="Install project dependencies"></a>Install project dependencies</h2><p>Navigate to project root directory:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd geoip</span><br></pre></td></tr></table></figure>

<p>Install dependencies:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod download</span><br></pre></td></tr></table></figure>

<h2 id="Copy-GeoLite2-files-into-position"><a href="robots.txt.html#Copy-GeoLite2-files-into-position" class="headerlink" title="Copy GeoLite2 files into position"></a>Copy GeoLite2 files into position</h2><p>Create a directory for the GeoLite2 databases:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir geolite2</span><br></pre></td></tr></table></figure>

<p>Copy the files below into your new <code>./geolite2 directory</code>. This will be a straight <code>cp</code> if you have them on the same computer, or an <code>scp</code> if they are on a different computer.</p>
<ul>
<li><code>GeoLite2-Country-Locations-en.csv</code></li>
<li><code>GeoLite2-Country-Blocks-IPv4.csv</code></li>
<li><code>GeoLite2-Country-Blocks-IPv6.csv</code></li>
</ul>
<h2 id="Edit-config-file"><a href="robots.txt.html#Edit-config-file" class="headerlink" title="Edit config file"></a>Edit config file</h2><p><code>go run ./</code> will use <code>config.json</code> in the current directory as the default configuration file.</p>
<p>Edit <code>config.json</code> in your <code>~/geoip</code> directory.</p>
<p>Make it look like this example. See <code>config-example.json</code> if you want more configuration option examples.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;input&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;maxmindGeoLite2CountryCSV&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;add&quot;,</span><br><span class="line">      &quot;args&quot;: &#123;</span><br><span class="line">        &quot;country&quot;: &quot;./geolite2/GeoLite2-Country-Locations-en.csv&quot;,</span><br><span class="line">        &quot;ipv4&quot;: &quot;./geolite2/GeoLite2-Country-Blocks-IPv4.csv&quot;,</span><br><span class="line">        &quot;ipv6&quot;: &quot;./geolite2/GeoLite2-Country-Blocks-IPv6.csv&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;private&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;add&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;test&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;add&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;output&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;v2rayGeoIPDat&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;output&quot;,</span><br><span class="line">      &quot;args&quot;: &#123;</span><br><span class="line">        &quot;outputName&quot;: &quot;geoip.dat&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;v2rayGeoIPDat&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;output&quot;,</span><br><span class="line">      &quot;args&quot;: &#123;</span><br><span class="line">        &quot;outputName&quot;: &quot;geoip-only-ir-private.dat&quot;,</span><br><span class="line">        &quot;wantedList&quot;: [&quot;ir&quot;, &quot;private&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;v2rayGeoIPDat&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;output&quot;,</span><br><span class="line">      &quot;args&quot;: &#123;</span><br><span class="line">        &quot;oneFilePerList&quot;: true,</span><br><span class="line">        &quot;wantedList&quot;: [&quot;ir&quot;, &quot;private&quot;, &quot;test&quot;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">      &quot;action&quot;: &quot;output&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Save your finished <code>config.json</code> file.</p>
<p>The <code>input</code> is the data source and its input format, whereas the <code>output</code> is the destination of the converted data and its output format. What the run will do is to aggregate all the <code>input</code> format data, then convert them to the <code>output</code> format and write them to the GeoIP file(s), using the options in the <code>config.json</code> file.</p>
<h2 id="Generate-GeoIP-files"><a href="robots.txt.html#Generate-GeoIP-files" class="headerlink" title="Generate GeoIP files"></a>Generate GeoIP files</h2><p>The generated files will be located in the output directory by default. Do <code>go run ./ -h</code> for more usage information. For a standard run, using your finished <code>config.json</code>, just do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/geoip</span><br><span class="line">go run ./</span><br><span class="line">ls -l output/dat</span><br></pre></td></tr></table></figure>

<h2 id="GeoIP-usage-example"><a href="robots.txt.html#GeoIP-usage-example" class="headerlink" title="GeoIP usage example"></a>GeoIP usage example</h2><h3 id="Client"><a href="robots.txt.html#Client" class="headerlink" title="Client"></a>Client</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">wget https://github.com/v2fly/v2ray-core/releases/download/v5.7.0/v2ray-linux-64.zip</span><br><span class="line">sudo apt install -y unzip</span><br><span class="line">unzip v2ray-linux-64.zip</span><br><span class="line">cp geoip/output/dat/* .</span><br><span class="line">./v2ray uuid</span><br></pre></td></tr></table></figure>

<p>Edit <code>config.json</code> and use this as an example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log&quot;: &#123;</span><br><span class="line">        &quot;loglevel&quot;: &quot;warning&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;routing&quot;: &#123;</span><br><span class="line">        &quot;domainStrategy&quot;: &quot;AsIs&quot;,</span><br><span class="line">        &quot;rules&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;type&quot;: &quot;field&quot;,</span><br><span class="line">                &quot;ip&quot;: [</span><br><span class="line">                    &quot;geoip:private&quot;,</span><br><span class="line">                    &quot;geoip:ir&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;outboundTag&quot;: &quot;direct&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;listen&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">            &quot;port&quot;: &quot;1080&quot;,</span><br><span class="line">            &quot;protocol&quot;: &quot;socks&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;auth&quot;: &quot;noauth&quot;,</span><br><span class="line">                &quot;udp&quot;: true,</span><br><span class="line">                &quot;ip&quot;: &quot;127.0.0.1&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;listen&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">            &quot;port&quot;: &quot;1081&quot;,</span><br><span class="line">            &quot;protocol&quot;: &quot;http&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;vmess&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;vnext&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;address&quot;: &quot;YOUR.SERVER.IP.ADDRESS&quot;,</span><br><span class="line">                        &quot;port&quot;: 1234,</span><br><span class="line">                        &quot;users&quot;: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                &quot;id&quot;: &quot;46daa707-ba12-b549-ff17-2d820486cd66&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;streamSettings&quot;: &#123;</span><br><span class="line">                &quot;network&quot;: &quot;tcp&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;tag&quot;: &quot;proxy&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">            &quot;tag&quot;: &quot;direct&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Save the file. Run with this <code>config.json</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./v2ray run</span><br></pre></td></tr></table></figure>

<h3 id="Server"><a href="robots.txt.html#Server" class="headerlink" title="Server"></a>Server</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su -</span><br><span class="line">apt install -y curl</span><br><span class="line">bash &lt;(curl -L https://raw.githubusercontent.com/v2fly/fhs-install-v2ray/master/install-release.sh)</span><br></pre></td></tr></table></figure>

<p>Edit the configuration file <code>/usr/local/etc/v2ray/config.json</code>, using this as an example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;log&quot;: &#123;</span><br><span class="line">        &quot;loglevel&quot;: &quot;warning&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;routing&quot;: &#123;</span><br><span class="line">        &quot;domainStrategy&quot;: &quot;AsIs&quot;,</span><br><span class="line">        &quot;rules&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;type&quot;: &quot;field&quot;,</span><br><span class="line">                &quot;ip&quot;: [</span><br><span class="line">                    &quot;geoip:private&quot;,</span><br><span class="line">                    &quot;geoip:ir&quot;</span><br><span class="line">                ],</span><br><span class="line">                &quot;outboundTag&quot;: &quot;block&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;inbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;listen&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;port&quot;: 1234,</span><br><span class="line">            &quot;protocol&quot;: &quot;vmess&quot;,</span><br><span class="line">            &quot;settings&quot;: &#123;</span><br><span class="line">                &quot;clients&quot;: [   </span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: &quot;46daa707-ba12-b549-ff17-2d820486cd66&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;streamSettings&quot;: &#123;</span><br><span class="line">                &quot;network&quot;: &quot;tcp&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;outbounds&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">            &quot;tag&quot;: &quot;direct&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;protocol&quot;: &quot;blackhole&quot;,</span><br><span class="line">            &quot;tag&quot;: &quot;block&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Enable and start:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable v2ray; systemctl start v2ray</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="https://cscot.pages.dev/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="https://cscot.pages.dev/page/4/">4</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="https://cscot.pages.dev/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Computer Scot</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="js/comments.js"></script><script src="js/utils.js"></script><script src="js/motion.js"></script><script src="js/next-boot.js"></script>

  






  





<!-- Cloudflare Pages Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "ba501be6c8b14145a726f9105bc6f827"}'></script><!-- Cloudflare Pages Analytics --></body>
</html>
